from charm.lib.utils import nice_time
from charm.lib import nygame

import pygame


def clean_lyric(word: str, last_word = False):
    if word.endswith("-"):
        word = word[:-1]
    elif last_word is False:
        word = word + " "
    word = word.replace("=", "-").replace("''", "\"")
    return word


# lyrics = [
#     {
#         "time": 3,
#         "end_time": 4.5,
#         "words": [
#             {"time": 0, "word": "Wow,"},
#             {"time": 0.5, "word": "this"},
#             {"time": 0.75, "word": "is"},
#             {"time": 1, "word": "cool!"},
#         ]
#     },
#     {
#         "time": 5.5,
#         "end_time": 8,
#         "words": [
#             {"time": 0, "word": "I"},
#             {"time": 0.5, "word": "real-"},
#             {"time": 0.75, "word": "ly"},
#             {"time": 1, "word": "like"},
#             {"time": 1.25, "word": "it!"}
#         ]
#     },
#     {
#         "time": 9,
#         "end_time": 10.5,
#         "words": [
#             {"time": 0, "word": "This"},
#             {"time": 0.1, "word": "is"},
#             {"time": 0.2, "word": "way"},
#             {"time": 0.3, "word": "too"},
#             {"time": 0.4, "word": "long,"},
#             {"time": 0.5, "word": "thus"},
#             {"time": 0.6, "word": "it"},
#             {"time": 0.7, "word": "must"},
#             {"time": 0.8, "word": "be"},
#             {"time": 0.9, "word": "shrunk"},
#             {"time": 1.0, "word": "in"},
#             {"time": 1.1, "word": "size!"},
#         ]
#     }
# ]

lyrics = [
    {
        'time': 4.875,
        'words': [
            {
                'time': 0.12812499999999982,
                'word': 'This'
            },
            {
                'time': 0.42708333333333304,
                'word': 'was'
            },
            {
                'time': 0.6364583333333336,
                'word': 'a'
            },
            {
                'time': 0.9281249999999996,
                'word': 'tri-'
            },
            {
                'time': 1.239583333333333,
                'word': 'umph'
            }
        ], 'end_time': 6.375
    },
    {
        'time': 8.75,
        'words': [
            {
                'time': 0.016666666666667496,
                'word': "I'm"
            },
            {
                'time': 0.2958333333333325,
                'word': 'mak-'
            },
            {
                'time': 0.5291666666666668,
                'word': 'ing'
            },
            {
                'time': 0.7593750000000004,
                'word': 'a'
            },
            {
                'time': 1.0062499999999996,
                'word': 'note'
            },
            {
                'time': 1.4552083333333332,
                'word': 'here'
            },
            {
                'time': 2.289583333333333,
                'word': 'HUGE'
            },
            {
                'time': 2.7906250000000004,
                'word': 'SUC-'
            },
            {
                'time': 3.0895833333333336,
                'word': 'CESS'
            }
        ], 'end_time': 12.125
    },
    {
        'time': 12.125,
        'words': [
            {
                'time': 1.6802083333333329,
                'word': "It's"
            },
            {
                'time': 1.9385416666666675,
                'word': 'hard'
            },
            {
                'time': 2.401041666666666,
                'word': 'to'
            },
            {
                'time': 2.705208333333333,
                'word': 'o-'
            },
            {
                'time': 3.3625000000000007,
                'word': 'ver-'
            },
            {
                'time': 3.651041666666666,
                'word': 'state'
            },
            {
                'time': 4.097916666666666,
                'word': 'my'
            },
            {
                'time': 4.793749999999999,
                'word': 'sat-'
            },
            {
                'time': 5.385416666666668,
                'word': 'is-'
            },
            {
                'time': 5.668749999999999,
                'word': 'fac-'
            },
            {
                'time': 6.139583333333334,
                'word': 'tion'
            }
        ], 'end_time': 20.875
    },
    {
        'time': 20.875,
        'words': [
            {
                'time': 0.12395833333333428,
                'word': 'Ap-'
            },
            {
                'time': 0.4187499999999993,
                'word': 'er-'
            },
            {
                'time': 0.607291666666665,
                'word': 'ture'
            },
            {
                'time': 0.8739583333333343,
                'word': 'Sci-'
            },
            {
                'time': 1.1791666666666671,
                'word': 'ence'
            }
        ], 'end_time': 22.375
    },
    {
        'time': 24.75,
        'words': [
            {
                'time': 0.02083333333333215,
                'word': 'We'
            },
            {
                'time': 0.23854166666666643,
                'word': 'do'
            },
            {
                'time': 0.4968749999999993,
                'word': 'what'
            },
            {
                'time': 0.78125,
                'word': 'we'
            },
            {
                'time': 1.0229166666666671,
                'word': 'must'
            },
            {
                'time': 1.763541666666665,
                'word': 'be-'
            },
            {
                'time': 2.0010416666666657,
                'word': 'cause'
            },
            {
                'time': 2.757291666666667,
                'word': 'we'
            },
            {
                'time': 3.0010416666666657,
                'word': 'can'
            }
        ], 'end_time': 28.25
    },
    {
        'time': 28.25,
        'words': [
            {
                'time': 1.7802083333333343,
                'word': 'For'
            },
            {
                'time': 2.279166666666665,
                'word': 'the'
            },
            {
                'time': 2.5124999999999993,
                'word': 'good'
            },
            {
                'time': 3.286458333333332,
                'word': 'of'
            },
            {
                'time': 3.5614583333333343,
                'word': 'all'
            },
            {
                'time': 4.259374999999999,
                'word': 'of'
            },
            {
                'time': 4.540624999999999,
                'word': 'us'
            }
        ], 'end_time': 33.25
    },
    {
        'time': 33.25,
        'words': [
            {
                'time': 0.0625,
                'word': 'Ex-'
            },
            {
                'time': 0.2593749999999986,
                'word': 'cept'
            },
            {
                'time': 0.5010416666666657,
                'word': 'the'
            },
            {
                'time': 0.7250000000000014,
                'word': 'ones'
            },
            {
                'time': 1.0541666666666671,
                'word': 'who'
            },
            {
                'time': 1.2520833333333314,
                'word': 'are'
            },
            {
                'time': 1.4989583333333343,
                'word': 'dead'
            }
        ], 'end_time': 35.0
    },
    {
        'time': 35.5,
        'words': [
            {
                'time': 0.03750000000000142,
                'word': 'But'
            },
            {
                'time': 0.25312499999999716,
                'word': "there's"
            },
            {
                'time': 0.49583333333333,
                'word': 'no'
            },
            {
                'time': 1.0104166666666643,
                'word': 'sense'
            },
            {
                'time': 1.4833333333333343,
                'word': 'cry-'
            },
            {
                'time': 1.7833333333333314,
                'word': 'ing'
            },
            {
                'time': 2.0010416666666657,
                'word': 'o-'
            },
            {
                'time': 2.5218750000000014,
                'word': 'ev-'
            },
            {
                'time': 2.765625,
                'word': 'ery'
            },
            {
                'time': 2.9781249999999986,
                'word': 'mis-'
            },
            {
                'time': 3.4750000000000014,
                'word': 'take'
            }
        ], 'end_time': 39.25
    },
    {
        'time': 39.25,
        'words': [
            {
                'time': 0.27812500000000284,
                'word': 'You'
            },
            {
                'time': 0.48854166666667,
                'word': 'just'
            },
            {
                'time': 0.74583333333333,
                'word': 'keep'
            },
            {
                'time': 1.2677083333333314,
                'word': 'on'
            },
            {
                'time': 1.7708333333333357,
                'word': 'try-'
            },
            {
                'time': 2.0489583333333314,
                'word': 'ing'
            },
            {
                'time': 2.253124999999997,
                'word': "'till"
            },
            {
                'time': 2.5062500000000014,
                'word': 'you'
            },
            {
                'time': 2.727083333333333,
                'word': 'run'
            },
            {
                'time': 3.003124999999997,
                'word': 'out'
            },
            {
                'time': 3.3031250000000014,
                'word': 'of'
            },
            {
                'time': 3.73854166666667,
                'word': 'cake'
            }
        ], 'end_time': 43.5
    },
    {
        'time': 43.5,
        'words': [
            {
                'time': 0.03020833333333428,
                'word': 'And'
            },
            {
                'time': 0.2666666666666657,
                'word': 'the'
            },
            {
                'time': 0.52708333333333,
                'word': 'sci-'
            },
            {
                'time': 0.7479166666666686,
                'word': 'ence'
            },
            {
                'time': 1.00416666666667,
                'word': 'gets'
            },
            {
                'time': 1.5135416666666686,
                'word': 'done'
            },
            {
                'time': 2.008333333333333,
                'word': 'and'
            },
            {
                'time': 2.2593749999999986,
                'word': 'you'
            },
            {
                'time': 2.5093749999999986,
                'word': 'make'
            },
            {
                'time': 2.7364583333333314,
                'word': 'a'
            },
            {
                'time': 3.0218750000000014,
                'word': 'neat'
            },
            {
                'time': 3.4947916666666643,
                'word': 'gun'
            }
        ], 'end_time': 47.46666666666667
    },
    {
        'time': 47.5,
        'words': [
            {
                'time': 0.02395833333333286,
                'word': 'For'
            },
            {
                'time': 0.28541666666667,
                'word': 'the'
            },
            {
                'time': 0.4854166666666657,
                'word': 'peo-'
            },
            {
                'time': 0.7635416666666686,
                'word': 'ple'
            },
            {
                'time': 1.015625,
                'word': 'who'
            },
            {
                'time': 1.2749999999999986,
                'word': 'are'
            },
            {
                'time': 1.7531249999999972,
                'word': 'still'
            },
            {
                'time': 2.0052083333333357,
                'word': 'a-'
            },
            {
                'time': 2.242708333333333,
                'word': 'live'
            }
        ], 'end_time': 50.5125
    },
    {
        'time': 56.625,
        'words': [
            {
                'time': 0.1041666666666643,
                'word': "I'm"
            },
            {
                'time': 0.3739583333333343,
                'word': 'not'
            },
            {
                'time': 0.6302083333333357,
                'word': 'e-'
            },
            {
                'time': 1.1083333333333343,
                'word': 'an-'
            },
            {
                'time': 1.55104166666667,
                'word': 'gry'
            }
        ], 'end_time': 58.505208333333336
    },
    {
        'time': 58.505208333333336,
        'words': [
            {
                'time': 2.5145833333333343,
                'word': "I'm"
            },
            {
                'time': 2.7947916666666615,
                'word': 'be-'
            },
            {
                'time': 3.0052083333333286,
                'word': 'ing'
            },
            {
                'time': 3.2802083333333343,
                'word': 'so'
            },
            {
                'time': 3.961458333333333,
                'word': 'sin-'
            },
            {
                'time': 4.266666666666666,
                'word': 'cere'
            },
            {
                'time': 4.76145833333333,
                'word': 'right'
            },
            {
                'time': 5.258333333333333,
                'word': 'now'
            }
        ], 'end_time': 65.875
    },
    {
        'time': 65.875,
        'words': [
            {
                'time': 0.09791666666666288,
                'word': 'E-'
            },
            {
                'time': 0.6302083333333286,
                'word': 'ven'
            },
            {
                'time': 0.8947916666666629,
                'word': 'though'
            },
            {
                'time': 1.6052083333333371,
                'word': 'you'
            },
            {
                'time': 2.1302083333333286,
                'word': 'broke'
            },
            {
                'time': 2.6104166666666657,
                'word': 'my'
            },
            {
                'time': 2.909374999999997,
                'word': 'heart'
            },
            {
                'time': 3.6197916666666714,
                'word': 'and'
            },
            {
                'time': 3.9166666666666714,
                'word': 'killed'
            },
            {
                'time': 4.473958333333329,
                'word': 'me'
            }
        ], 'end_time': 70.875
    },
    {
        'time': 70.875,
        'words': [
            {
                'time': 1.9114583333333286,
                'word': 'And'
            },
            {
                'time': 2.152083333333337,
                'word': 'tore'
            },
            {
                'time': 2.3895833333333343,
                'word': 'me'
            },
            {
                'time': 2.6260416666666657,
                'word': 'to'
            },
            {
                'time': 2.859375,
                'word': 'pie-'
            },
            {
                'time': 3.136458333333337,
                'word': 'ces'
            }
        ], 'end_time': 76.75
    },
    {
        'time': 76.75,
        'words': [
            {
                'time': 0.019791666666662877,
                'word': 'And'
            },
            {
                'time': 0.25312499999999716,
                'word': 'threw'
            },
            {
                'time': 0.56979166666666,
                'word': 'ev-'
            },
            {
                'time': 0.7843749999999972,
                'word': 'ery'
            },
            {
                'time': 1.0031249999999972,
                'word': 'piece'
            },
            {
                'time': 1.7833333333333314,
                'word': 'in-'
            },
            {
                'time': 2.03125,
                'word': 'to'
            },
            {
                'time': 2.72604166666666,
                'word': 'a'
            },
            {
                'time': 3.0416666666666714,
                'word': 'fire'
            }
        ], 'end_time': 80.25
    },
    {
        'time': 80.25,
        'words': [
            {
                'time': 1.7552083333333286,
                'word': 'As'
            },
            {
                'time': 2.2593750000000057,
                'word': 'they'
            },
            {
                'time': 2.519791666666663,
                'word': 'burned'
            },
            {
                'time': 3.2906250000000057,
                'word': 'it'
            },
            {
                'time': 3.72708333333334,
                'word': 'hurt'
            },
            {
                'time': 4.255208333333329,
                'word': 'be-'
            },
            {
                'time': 4.49270833333334,
                'word': 'cause'
            }
        ], 'end_time': 85.25
    },
    {
        'time': 85.25,
        'words': [
            {
                'time': 0.07604166666666856,
                'word': 'I'
            },
            {
                'time': 0.28958333333333997,
                'word': 'was'
            },
            {
                'time': 0.5135416666666686,
                'word': 'so'
            },
            {
                'time': 0.7677083333333314,
                'word': 'hap-'
            },
            {
                'time': 0.97708333333334,
                'word': 'py'
            },
            {
                'time': 1.2291666666666714,
                'word': 'for'
            },
            {
                'time': 1.5208333333333286,
                'word': 'you'
            }
        ], 'end_time': 87.125
    },
    {
        'time': 87.375,
        'words': [
            {
                'time': 0.09062500000000284,
                'word': 'Now'
            },
            {
                'time': 0.3854166666666714,
                'word': 'these'
            },
            {
                'time': 0.6260416666666657,
                'word': 'points'
            },
            {
                'time': 1.13333333333334,
                'word': 'of'
            },
            {
                'time': 1.6281249999999972,
                'word': 'da-'
            },
            {
                'time': 1.8947916666666629,
                'word': 'ta'
            },
            {
                'time': 2.109375,
                'word': 'make'
            },
            {
                'time': 2.3541666666666714,
                'word': 'a'
            },
            {
                'time': 2.5947916666666657,
                'word': 'beau-'
            },
            {
                'time': 2.856250000000003,
                'word': 'ti-'
            },
            {
                'time': 3.140625,
                'word': 'ful'
            },
            {
                'time': 3.640625,
                'word': 'line'
            }
        ], 'end_time': 91.5
    },
    {
        'time': 91.5,
        'words': [
            {
                'time': 0.03333333333333144,
                'word': 'And'
            },
            {
                'time': 0.22291666666666288,
                'word': "we're"
            },
            {
                'time': 0.5145833333333343,
                'word': 'out'
            },
            {
                'time': 0.9937500000000057,
                'word': 'of'
            },
            {
                'time': 1.4958333333333371,
                'word': 'be-'
            },
            {
                'time': 1.7458333333333371,
                'word': 'ta'
            },
            {
                'time': 1.99166666666666,
                'word': "we're"
            },
            {
                'time': 2.237499999999997,
                'word': 're-'
            },
            {
                'time': 2.4864583333333314,
                'word': 'leas-'
            },
            {
                'time': 2.74270833333334,
                'word': 'ing'
            },
            {
                'time': 3.02395833333334,
                'word': 'on'
            },
            {
                'time': 3.47708333333334,
                'word': 'time'
            }
        ], 'end_time': 95.375
    },
    {
        'time': 95.375,
        'words': [
            {
                'time': 0.11354166666666288,
                'word': 'So'
            },
            {
                'time': 0.4052083333333343,
                'word': "I'm"
            },
            {
                'time': 0.625,
                'word': 'GLaD'
            },
            {
                'time': 0.890625,
                'word': 'I'
            },
            {
                'time': 1.1281249999999972,
                'word': 'got'
            },
            {
                'time': 1.6458333333333286,
                'word': 'burned'
            },
            {
                'time': 2.1385416666666686,
                'word': 'think'
            },
            {
                'time': 2.378124999999997,
                'word': 'of'
            },
            {
                'time': 2.63229166666666,
                'word': 'all'
            },
            {
                'time': 2.8812499999999943,
                'word': 'the'
            },
            {
                'time': 3.1395833333333343,
                'word': 'things'
            },
            {
                'time': 3.4072916666666657,
                'word': 'we'
            },
            {
                'time': 3.6500000000000057,
                'word': 'learned'
            }
        ], 'end_time': 99.5
    },
    {
        'time': 99.5,
        'words': [
            {
                'time': 0.027083333333337123,
                'word': 'For'
            },
            {
                'time': 0.27916666666666856,
                'word': 'the'
            },
            {
                'time': 0.49687500000000284,
                'word': 'peo-'
            },
            {
                'time': 0.7708333333333286,
                'word': 'ple'
            },
            {
                'time': 1.0010416666666657,
                'word': 'who'
            },
            {
                'time': 1.2750000000000057,
                'word': 'are'
            },
            {
                'time': 1.77291666666666,
                'word': 'still'
            },
            {
                'time': 2.02395833333334,
                'word': 'a-'
            },
            {
                'time': 2.2593750000000057,
                'word': 'live'
            }
        ], 'end_time': 102.746875
    },
    {
        'time': 108.875,
        'words': [
            {
                'time': 0.10208333333333997,
                'word': 'Go'
            },
            {
                'time': 0.31458333333333144,
                'word': 'a-'
            },
            {
                'time': 0.38750000000000284,
                'word': 'head'
            },
            {
                'time': 0.7000000000000028,
                'word': 'and'
            },
            {
                'time': 1.00833333333334,
                'word': 'leave'
            },
            {
                'time': 1.4822916666666686,
                'word': 'me'
            }
        ], 'end_time': 110.875
    },
    {
        'time': 110.875,
        'words': [
            {
                'time': 1.8802083333333286,
                'word': 'I'
            },
            {
                'time': 2.1239583333333343,
                'word': 'think'
            },
            {
                'time': 2.3802083333333286,
                'word': "I'd"
            },
            {
                'time': 2.644791666666663,
                'word': 'pre-'
            },
            {
                'time': 2.90625,
                'word': 'fer'
            },
            {
                'time': 3.5875000000000057,
                'word': 'to'
            },
            {
                'time': 3.90625,
                'word': 'stay'
            },
            {
                'time': 4.626041666666666,
                'word': 'in-'
            },
            {
                'time': 4.894791666666663,
                'word': 'side'
            }
        ], 'end_time': 118.0
    },
    {
        'time': 118.0,
        'words': [
            {
                'time': 0.012500000000002842,
                'word': 'May-'
            },
            {
                'time': 0.5052083333333286,
                'word': 'be'
            },
            {
                'time': 0.8229166666666714,
                'word': "you'll"
            },
            {
                'time': 1.5020833333333314,
                'word': 'find'
            },
            {
                'time': 2.0093750000000057,
                'word': 'some-'
            },
            {
                'time': 2.496875000000003,
                'word': 'one'
            },
            {
                'time': 2.7395833333333286,
                'word': 'else'
            },
            {
                'time': 3.50833333333334,
                'word': 'to'
            },
            {
                'time': 3.8760416666666657,
                'word': 'help'
            },
            {
                'time': 4.208333333333329,
                'word': 'you'
            }
        ], 'end_time': 122.75
    },
    {
        'time': 124.875,
        'words': [
            {
                'time': 0.12395833333333428,
                'word': 'May-'
            },
            {
                'time': 0.4677083333333343,
                'word': 'be'
            },
            {
                'time': 0.6510416666666714,
                'word': 'Black'
            },
            {
                'time': 0.97604166666666,
                'word': 'Me-'
            },
            {
                'time': 1.4395833333333314,
                'word': 'sa'
            }
        ], 'end_time': 126.75
    },
    {
        'time': 128.875,
        'words': [
            {
                'time': 0.12083333333333712,
                'word': 'THAT'
            },
            {
                'time': 0.4177083333333371,
                'word': 'WAS'
            },
            {
                'time': 0.6260416666666799,
                'word': 'A'
            },
            {
                'time': 0.8885416666666686,
                'word': 'JOKE'
            },
            {
                'time': 1.6177083333333258,
                'word': 'HA'
            },
            {
                'time': 1.90625,
                'word': 'HA'
            },
            {
                'time': 2.59375,
                'word': 'FAT'
            },
            {
                'time': 2.9302083333333258,
                'word': 'CHANCE'
            }
        ], 'end_time': 132.25
    },
    {
        'time': 132.25,
        'words': [
            {
                'time': 1.7541666666666629,
                'word': 'An-'
            },
            {
                'time': 2.2635416666666686,
                'word': 'y-'
            },
            {
                'time': 2.5239583333333258,
                'word': 'way'
            },
            {
                'time': 3.285416666666663,
                'word': 'this'
            },
            {
                'time': 3.7437500000000057,
                'word': 'cake'
            },
            {
                'time': 4.240624999999994,
                'word': 'is'
            },
            {
                'time': 4.511458333333337,
                'word': 'great'
            }
        ], 'end_time': 137.125
    },
    {
        'time': 137.125,
        'words': [
            {
                'time': 0.12187499999998863,
                'word': "It's"
            },
            {
                'time': 0.37604166666667993,
                'word': 'so'
            },
            {
                'time': 0.6270833333333314,
                'word': 'del-'
            },
            {
                'time': 0.875,
                'word': 'i-'
            },
            {
                'time': 1.09479166666668,
                'word': 'cious'
            },
            {
                'time': 1.3697916666666572,
                'word': 'and'
            },
            {
                'time': 1.6197916666666572,
                'word': 'moist'
            }
        ], 'end_time': 139.0
    },
    {
        'time': 139.0,
        'words': [
            {
                'time': 0.5187500000000114,
                'word': 'Look'
            },
            {
                'time': 0.7437500000000057,
                'word': 'at'
            },
            {
                'time': 1.0031250000000114,
                'word': 'me'
            },
            {
                'time': 1.4937500000000057,
                'word': 'still'
            },
            {
                'time': 1.9947916666666572,
                'word': 'talk-'
            },
            {
                'time': 2.2468749999999886,
                'word': 'ing'
            },
            {
                'time': 2.504166666666663,
                'word': 'when'
            },
            {
                'time': 2.730208333333337,
                'word': "there's"
            },
            {
                'time': 2.96979166666668,
                'word': 'sci-'
            },
            {
                'time': 3.2531250000000114,
                'word': 'ence'
            },
            {
                'time': 3.49895833333332,
                'word': 'to'
            },
            {
                'time': 3.9906249999999943,
                'word': 'do'
            }
        ], 'end_time': 143.5
    },
    {
        'time': 143.5,
        'words': [
            {
                'time': 0.046875,
                'word': 'When'
            },
            {
                'time': 0.2562499999999943,
                'word': 'I'
            },
            {
                'time': 0.5104166666666572,
                'word': 'look'
            },
            {
                'time': 0.9677083333333201,
                'word': 'out'
            },
            {
                'time': 1.4968749999999886,
                'word': 'there'
            },
            {
                'time': 1.7635416666666686,
                'word': 'it'
            },
            {
                'time': 1.96979166666668,
                'word': 'makes'
            },
            {
                'time': 2.2281250000000057,
                'word': 'me'
            },
            {
                'time': 2.457291666666663,
                'word': 'GLaD'
            },
            {
                'time': 2.6999999999999886,
                'word': "I'm"
            },
            {
                'time': 3.0020833333333314,
                'word': 'not'
            },
            {
                'time': 3.4968749999999886,
                'word': 'you'
            }
        ], 'end_time': 147.4375
    },
    {
        'time': 147.4375,
        'words': [
            {
                'time': 0.04166666666665719,
                'word': "I've"
            },
            {
                'time': 0.2854166666666629,
                'word': 'ex-'
            },
            {
                'time': 0.5718750000000057,
                'word': 'per-'
            },
            {
                'time': 0.8041666666666742,
                'word': 'i-'
            },
            {
                'time': 1.0406250000000057,
                'word': 'ments'
            },
            {
                'time': 1.2916666666666572,
                'word': 'to'
            },
            {
                'time': 1.5739583333333371,
                'word': 'run'
            },
            {
                'time': 2.0687499999999943,
                'word': 'there'
            },
            {
                'time': 2.308333333333337,
                'word': 'is'
            },
            {
                'time': 2.578125,
                'word': 're-'
            },
            {
                'time': 2.8052083333333258,
                'word': 'search'
            },
            {
                'time': 3.0802083333333314,
                'word': 'to'
            },
            {
                'time': 3.3145833333333314,
                'word': 'be'
            },
            {
                'time': 3.5906249999999886,
                'word': 'done'
            }
        ], 'end_time': 151.5
    },
    {
        'time': 151.5,
        'words': [
            {
                'time': 0.006249999999994316,
                'word': 'On'
            },
            {
                'time': 0.24583333333333712,
                'word': 'the'
            },
            {
                'time': 0.5020833333333314,
                'word': 'peo-'
            },
            {
                'time': 1.0031250000000114,
                'word': 'who'
            },
            {
                'time': 1.2541666666666629,
                'word': 'are'
            },
            {
                'time': 1.7395833333333428,
                'word': 'still'
            },
            {
                'time': 1.99895833333332,
                'word': 'a-'
            },
            {
                'time': 2.26666666666668,
                'word': 'live'
            }
        ], 'end_time': 154.684375
    },
    {
        'time': 154.684375,
        'words': [
            {
                'time': 0.8416666666666686,
                'word': 'And'
            },
            {
                'time': 1.1114583333333314,
                'word': 'be-'
            },
            {
                'time': 1.32916666666668,
                'word': 'lieve'
            },
            {
                'time': 1.59375,
                'word': 'me'
            },
            {
                'time': 1.8552083333333371,
                'word': 'I'
            },
            {
                'time': 2.1010416666666742,
                'word': 'am'
            },
            {
                'time': 2.575000000000017,
                'word': 'still'
            },
            {
                'time': 2.8322916666666913,
                'word': 'a-'
            },
            {
                'time': 3.1031250000000057,
                'word': 'live'
            }
        ], 'end_time': 159.25
    },
    {
        'time': 159.25,
        'words': [
            {
                'time': 0.039583333333325754,
                'word': "I'm"
            },
            {
                'time': 0.25729166666667425,
                'word': 'do-'
            },
            {
                'time': 0.5093750000000057,
                'word': 'ing'
            },
            {
                'time': 0.7531250000000114,
                'word': 'sci-'
            },
            {
                'time': 1.03229166666668,
                'word': 'ence'
            },
            {
                'time': 1.2427083333333258,
                'word': 'and'
            },
            {
                'time': 1.5250000000000057,
                'word': "I'm"
            },
            {
                'time': 2.0229166666666742,
                'word': 'still'
            },
            {
                'time': 2.29791666666668,
                'word': 'a-'
            },
            {
                'time': 2.5395833333333258,
                'word': 'live'
            }
        ], 'end_time': 162.25
    },
    {
        'time': 162.25,
        'words': [
            {
                'time': 1.0083333333333258,
                'word': 'I'
            },
            {
                'time': 1.2322916666666686,
                'word': 'feel'
            },
            {
                'time': 1.4958333333333371,
                'word': 'fan-'
            },
            {
                'time': 1.7156249999999886,
                'word': 'tas-'
            },
            {
                'time': 2.0500000000000114,
                'word': 'tic'
            },
            {
                'time': 2.2520833333333314,
                'word': 'and'
            },
            {
                'time': 2.5333333333333314,
                'word': "I'm"
            },
            {
                'time': 3.005208333333343,
                'word': 'still'
            },
            {
                'time': 3.269791666666663,
                'word': 'a-'
            },
            {
                'time': 3.5218749999999943,
                'word': 'live'
            }
        ], 'end_time': 167.375
    },
    {
        'time': 167.375,
        'words': [
            {
                'time': 0.12291666666666856,
                'word': 'While'
            },
            {
                'time': 0.36041666666667993,
                'word': "you're"
            },
            {
                'time': 0.5999999999999943,
                'word': 'dy-'
            },
            {
                'time': 0.9145833333333258,
                'word': 'ing'
            },
            {
                'time': 1.1666666666666572,
                'word': "I'll"
            },
            {
                'time': 1.4729166666666629,
                'word': 'be'
            },
            {
                'time': 1.8635416666666629,
                'word': 'still'
            },
            {
                'time': 2.140625,
                'word': 'a-'
            },
            {
                'time': 2.4083333333333314,
                'word': 'live'
            }
        ], 'end_time': 170.25
    },
    {
        'time': 170.25,
        'words': [
            {
                'time': 1.0208333333333428,
                'word': 'And'
            },
            {
                'time': 1.2468749999999886,
                'word': 'when'
            },
            {
                'time': 1.49895833333332,
                'word': "you're"
            },
            {
                'time': 1.7385416666666629,
                'word': 'dead'
            },
            {
                'time': 2.0250000000000057,
                'word': 'I'
            },
            {
                'time': 2.2375000000000114,
                'word': 'will'
            },
            {
                'time': 2.5593749999999886,
                'word': 'be'
            },
            {
                'time': 3.010416666666657,
                'word': 'still'
            },
            {
                'time': 3.28125,
                'word': 'a-'
            },
            {
                'time': 3.5489583333333314,
                'word': 'live'
            }
        ], 'end_time': 175.25
    },
    {
        'time': 175.25,
        'words': [
            {
                'time': 0.010416666666657193,
                'word': 'Still'
            },
            {
                'time': 0.29374999999998863,
                'word': 'a-'
            },
            {
                'time': 0.5395833333333258,
                'word': 'live'
            },
            {
                'time': 2.0020833333333314,
                'word': 'still'
            },
            {
                'time': 2.385416666666657,
                'word': 'a-'
            },
            {
                'time': 2.54791666666668,
                'word': 'live'
            }
        ], 'end_time': 178.25
    }
]


class LyricAnimator:
    def __init__(self, clock: nygame.time.Clock, phrases: list = lyrics, *,
                 size: tuple = (600, 400), font = "Lato Medium"):
        self.clock = clock
        self.phrases = phrases
        self.width = size[0]
        self.height = size[1]
        self.font = font

    @property
    def current_time(self):
        return nygame.time.get_ticks_sec()

    @property
    def image(self) -> pygame.Surface:
        surf = pygame.Surface((self.width, self.height), pygame.SRCALPHA)
        surf.fill((0, 0, 0))

        current_phrase = None
        for p in self.phrases:
            if p["time"] <= self.current_time <= (p["end_time"] + 1):
                current_phrase = p

        current_line = ""
        if current_phrase:
            for w in current_phrase["words"]:
                current_line += clean_lyric(w["word"])
        current_line = current_line.rstrip()

        current_font = None
        current_size = 48
        while current_font is None and current_size > 4:
            font = pygame.font.SysFont(self.font, current_size)
            if font.size(current_line)[0] <= (self.width * 0.75):
                current_font = font
            current_size -= 2

        text_surf = pygame.Surface(current_font.size(current_line), pygame.SRCALPHA)

        if current_phrase:
            on = ""
            off = ""
            for w in current_phrase["words"]:
                if w["time"] <= (self.current_time - current_phrase["time"]):
                    on += clean_lyric(w["word"])
                else:
                    off += clean_lyric(w["word"])
            off = off.rstrip()

            on_surf = current_font.render(on, True, (255, 255, 0))
            off_surf = current_font.render(off, True, (128, 128, 128))

            text_surf.blit(on_surf, (0, 0))
            text_surf.blit(off_surf, (on_surf.get_width(), 0))

            text_surf.set_alpha(
                255 - (max(0, self.current_time - current_phrase["end_time"]) * 255)
            )

        time_font = pygame.font.SysFont(self.font, 24)
        time_surf = time_font.render(nice_time(self.current_time, True), True, (0, 255, 0))

        surf.blit(time_surf, (0, 0))
        surf.blit(text_surf, (
            (surf.get_width() - text_surf.get_width()) / 2,
            (surf.get_height() - text_surf.get_height()) / 2
        ))

        return surf
